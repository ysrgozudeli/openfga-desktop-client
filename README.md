# OpenFGA Desktop Client

A JavaFX desktop application for managing [OpenFGA](https://openfga.dev/) authorization servers. This tool provides a user-friendly interface for creating stores, managing authorization models (DSL), writing tuples, and running authorization checks.

## Features

- **Store Management**: Create, list, and delete OpenFGA stores
- **DSL Model Editor**:
  - Syntax highlighting with line numbers
  - Auto-format functionality
  - DSL validation before applying
  - JSON preview for debugging
- **Model Visualization**: Interactive graph view of your authorization model
  - Visual representation of types and their relations
  - Color-coded direct vs computed relations
  - Condition blocks displayed separately
- **Tuple Management**: Write and delete relationship tuples with support for conditions
- **Authorization Checks**: Run check queries with optional context
- **Advanced Queries**:
  - **List Objects**: Find all objects a user can access
  - **List Users**: Find all users who can access an object
  - **Expand**: Debug how permissions are computed
  - **Read Tuples**: View existing tuples in the store
- **AI-Friendly Input**: Text format for tuples and checks that can be easily generated by AI tools

## Screenshots

```
┌─────────────────────────────────────────────────────────────────┐
│ Configuration                                                    │
│ API URL: [http://localhost:18080]  Token: [________]            │
│ Store: [my-store (abc123...)    ▼]  [List Stores]               │
├─────────────────────────────────────────────────────────────────┤
│ [Stores] [Model] [Visualize] [Tuples] [Check] [Query]           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Model Editor with Line Numbers    │  Graph Visualization       │
│  ┌────┬────────────────────────┐   │  ┌──────┐    ┌──────┐     │
│  │ 1  │ model                  │   │  │ user │───▶│tenant│     │
│  │ 2  │   schema 1.1           │   │  └──────┘    └──────┘     │
│  │ 3  │                        │   │      │                     │
│  │ 4  │ type user              │   │      ▼                     │
│  │ ...│ ...                    │   │  ┌────────┐               │
│  └────┴────────────────────────┘   │  │carefile│               │
│                                     │  └────────┘               │
│  [Auto Format] [Validate] [Apply]  │                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Prerequisites

- **Java 21** or later
- **Maven 3.8+**
- **OpenFGA CLI** (for DSL transformation)
- **OpenFGA Server** running locally or remotely

### Installing OpenFGA CLI

**Windows (winget):**
```powershell
winget install openfga.cli
```

**Windows (Scoop):**
```powershell
scoop bucket add openfga https://github.com/openfga/scoop-bucket.git
scoop install openfga
```

**macOS (Homebrew):**
```bash
brew install openfga/tap/fga
```

**Linux:**
```bash
# Download from GitHub releases
curl -L https://github.com/openfga/cli/releases/latest/download/fga_Linux_x86_64.tar.gz | tar xz
sudo mv fga /usr/local/bin/
```

Verify installation:
```bash
fga version
```

## Installation

1. **Clone the repository:**
   ```bash
   git clone https://github.com/ysrgozudeli/openfga-desktop-client.git
   cd openfga-desktop-client
   ```

2. **Build and run:**
   ```bash
   mvn clean javafx:run
   ```

## Usage

### 1. Connect to OpenFGA Server

1. Enter your OpenFGA server URL (default: `http://localhost:18080`)
2. Add Bearer token if authentication is required
3. Click **"List Stores"** to connect

### 2. Create a Store

1. Go to **Stores** tab
2. Enter a store name
3. Click **"Create Store"**

### 3. Apply an Authorization Model

1. Go to **Model** tab
2. Write or paste your DSL model (example included by default)
3. Click **"Auto Format"** to fix indentation
4. Click **"Validate DSL"** to check syntax
5. Click **"Apply Model"** to deploy to OpenFGA

### 4. Visualize the Model

1. Go to **Visualize** tab
2. Click **"Refresh Graph"**
3. View your types, relations, and conditions as a graph

### 5. Write Tuples

1. Go to **Tuples** tab
2. Enter tuple in text format:
   ```
   user: user:alice
   relation: editor
   object: document:readme
   ```
3. For conditional tuples, add:
   ```
   user: user:bob
   relation: editor
   object: document:report
   condition: time_valid
   context: {"current_time": "2025-01-01T00:00:00Z", "expiry_time": "2025-12-31T23:59:59Z"}
   ```
4. Click **"Write Tuple"**

### 6. Run Authorization Checks

1. Go to **Check** tab
2. Enter check query:
   ```
   user: user:alice
   relation: viewer
   object: document:readme
   ```
3. Click **"Check"**
4. See result: **ALLOWED** or **DENIED**

### 7. Advanced Queries

Go to **Query** tab for advanced operations (all use text format):

#### List Objects
"What documents can Alice view?"
```
user: user:alice
relation: viewer
type: document
context: {"user_role": "admin"}
```

#### List Users
"Who can view this document?"
```
object: document:readme
relation: viewer
usertype: user
context: {"user_role": "admin"}
```

#### Expand
"How is the viewer permission computed?"
```
object: document:readme
relation: viewer
```

#### Read Tuples
"What tuples exist in the store?"
```
user: user:alice
relation: viewer
object: document:readme
```
All fields are optional filters.

## Text Format for AI Tools

The Tuples and Check tabs accept a simple text format that AI tools can easily generate:

```
user: user:alice
relation: viewer
object: document:123
condition: time_valid
context: {"current_time": "2025-01-01T00:00:00Z", "expiry_time": "2025-12-31T23:59:59Z"}
```

Each line is a key-value pair. `condition` and `context` are optional.

## DSL Format

OpenFGA DSL uses a specific format. The auto-formatter handles indentation:

```
model
  schema 1.1

type user

type organization
  relations
    define owner: [user]
    define admin: [user] or owner
    define member: [user] or admin

type document
  relations
    define org: [organization]
    define owner: [user]
    define editor: [user, user with time_valid] or owner
    define viewer: [user, organization#member] or editor

condition time_valid(current_time: timestamp, expiry_time: timestamp) {
  current_time < expiry_time
}
```

**Important:** Conditions must be placed at the end of the model file.

## Project Structure

```
openfga-desktop-client/
├── pom.xml
├── README.md
├── LICENSE
└── src/main/java/com/openfga/client/
    ├── App.java                      # Main application & UI
    ├── model/
    │   └── StoreInfo.java            # Store data model
    └── service/
        ├── OpenFGAService.java       # OpenFGA API client
        └── DslTransformService.java  # FGA CLI wrapper
```

## Tech Stack

- **Java 21**
- **JavaFX 21** - UI framework
- **OpenFGA CLI** - DSL to JSON transformation
- **Jackson** - JSON processing
- **Maven** - Build tool

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

- [OpenFGA](https://openfga.dev/) - The authorization engine this client interfaces with
- [OpenFGA CLI](https://github.com/openfga/cli) - Used for DSL transformation

## Related Links

- [OpenFGA Documentation](https://openfga.dev/docs)
- [OpenFGA GitHub](https://github.com/openfga/openfga)
- [OpenFGA DSL Syntax](https://openfga.dev/docs/configuration-language)
